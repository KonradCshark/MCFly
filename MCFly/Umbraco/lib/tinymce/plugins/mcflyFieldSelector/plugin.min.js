tinymce.PluginManager.add('mcflyFieldSelector', function (editor) {

    function populate(fieldAlias) {

       

        editor.insertContent('{' + fieldAlias + '}');


    };
    editor.addButton('mcflyFieldSelector', {

        icon: 'custom icon-book-alt',

        tooltip: 'Form field selector',

        onclick: function (e) {
            //get your angular element
            var elem = angular.element(document.querySelector('[ng-controller]'));

            //get the scope.
            var $scope = elem.scope();

            //get the injector.
            var injector = elem.injector();

            //get the services.
            var dialogService = injector.get('dialogService');
            var $routeParams = injector.get('$routeParams');
           
            var id = $routeParams.id;
           
            

            myDialog = dialogService.open({
                template: "/App_Plugins/MCFly/backoffice/dialogs/tinyMCESelectField.html",
                dialogData: {
                    formId: id,
                    form: $scope.form
                },
                callback: populate
            });

               
        }
        
    });
});